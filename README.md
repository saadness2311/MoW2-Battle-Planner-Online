=========================================
      MAP PLANNER / STRATEGY TOOL
            Версия 2.01
=========================================

Описание:
---------
Это интерактивный редактор карт для стратегических планов и боевых сценариев. Позволяет создавать, сохранять и загружать планы с маркерами игроков, символами и линиями фронта. Поддерживает работу с несколькими "эшелонами" (состояниями карты) для моделирования последовательных фаз боя.

Основные возможности:
--------------------
1. **Карты**
   - Автоподгрузка карт из папки `assets/maps/` (map1..map25).
   - Поддержка альтернативных вариантов карты (suffix -alt).
   - Просмотр и центрирование карты через Leaflet.

2. **Эшелоны**
   - 3 уровня состояния карты (Эшелон 1..3).
   - Возможность переключения между эшелонами.
   - Копирование текущего состояния в следующий эшелон.
   - Сохранение и восстановление каждого эшелона отдельно.

3. **Игроки**
   - 2 команды (Red и Blue), по 5 игроков каждая.
   - Настройка ника, нации (USSR, Germany, USA) и полка.
   - Установка маркера игрока на карте с изображением полка.
   - Перетаскивание маркера мышью.

4. **Символы**
   - Категории: Армия, Инженеры, Символы.
   - Выбор и установка символов на карту кликом.
   - Простые символы: точки, кресты, стрелки, треугольники и т.д.
   - Удаление символа кликом.

5. **Рисование**
   - Линии, полигоны, круги.
   - Настройка цвета и толщины через UI.
   - Кнопки "Фронт" и "Заливка нижней части" для быстрого создания стандартных фигур.
   - Ластик для удаления всех рисунков или очистка всей карты.

6. **Наступление**
   - Анимация стрелок ("assault") сверху вниз.
   - Периодическое создание стрелок каждые 30 секунд.
   - Можно остановить или запустить заново.

7. **Сохранение и загрузка**
   - План сохраняется в формате JSON с учётом эшелонов.
   - Возможна загрузка старых и новых форматов планов.
   - Автоматическое восстановление маркеров, символов, рисунков и позиции карты.
   - Сохранение карты в PNG с текущим состоянием.

8. **UI элементы**
   - Панель выбора карты.
   - Эшелоны (переключение стрелками).
   - Панель символов с вкладками.
   - Настройка цвета и толщины линий.
   - Кнопки готовых фигур, наступления, ластика и очистки.
   - Кнопки сохранения JSON и PNG.

Рекомендации для новичков:
--------------------------
1. Сначала выберите карту из списка и загрузите её.
2. Настройте эшелон 1 и расставьте маркеры игроков.
3. Используйте вкладки символов для добавления знаков и простых фигур.
4. При необходимости добавьте линии фронта или зоны заливки.
5. Переключайтесь между эшелонами для моделирования разных фаз боя.
6. Сохраняйте план в JSON для дальнейшего редактирования или PNG для презентации.
7. Используйте кнопку "assault" для визуализации наступления противника.
8. Для удаления элементов используйте ластик или кликайте по символам/маркерам.

Советы:
-------
- Всегда сохраняйте текущий эшелон перед переключением.
- Маркеры игроков можно перетаскивать мышью для точной расстановки.
- Простые символы масштабируются автоматически по размеру карты.
- Если изображение полка не найдено, используется заглушка.




## Инструкция: как подключить Supabase (шаг за шагом)

1. Зарегистрируйся на https://supabase.com и создай новый проект (Free).
2. В проекте открой `Table Editor` -> `New Table` и создай таблицу `rooms` со следующими полями:
   - `id` UUID — primary key (по умолчанию генерируется с помощью `gen_random_uuid()`).
   - `name` text
   - `state` jsonb
   - `created_at` timestamptz DEFAULT now()
   - `updated_at` timestamptz
   - `last_editor` text
3. В `Settings -> API` возьми `Project URL` и `anon public` ключ (Public API key).
4. В `index.html` найди строки вверху:
```js
const SUPABASE_URL = 'https://YOUR_PROJECT.supabase.co';
const SUPABASE_ANON_KEY = 'YOUR_PUBLIC_ANON_KEY';
```
и замени их на твой `Project URL` и `anon key`.
5. Разверни сайт (например, на GitHub Pages / Netlify). Открой страницу — в панели «Rooms» создай комнату и введи ник.
6. Механика синхронизации: при каждом сохранении состояния (функция `saveCurrentEchelonState`) весь текущий `echelonStates` сохраняется в поле `state` таблицы `rooms`. Другие участники, подписанные на комнату, получат обновление в реальном времени и подгрузят состояние.
7. Если хочешь синхронизацию более частичных действий (по одному маркеру), в `script.js` можно заменить логику сохранения: вместо загрузки всего состояния — отправлять отдельные запросы в таблицу `icons` (я оставляю это как возможное улучшение).

Примечание: я намеренно не менял основной дизайн и логику сайта — добавлена лишь верхняя панель и хуки сохранения/загрузки состояния из Supabase.
