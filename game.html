<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MoW2 Battle Planner</title>

  <!-- Leaflet + Draw CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–∞ –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–º–Ω–∞—Ç—ã -->
  <script>
    console.log("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–º–Ω–∞—Ç—ã...");
    const user = JSON.parse(localStorage.getItem('user'));
    const roomId = localStorage.getItem('roomId');

    if (!user) {
      console.error("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage!");
      alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!");
      window.location.href = 'index.html';
    } else if (!roomId) {
      console.error("‚ùå –ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞!");
      alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É!");
      window.location.href = 'lobby.html';
    } else {
      console.log(`‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.username}, –ö–æ–º–Ω–∞—Ç–∞: ${roomId}`);
    }
  </script>

  <div class="app">
    <aside class="sidebar">
      <h1>MoW2 Battle Planner</h1>

      <section class="map-select">
        <label for="mapSelect">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É:</label>
        <select id="mapSelect" aria-label="–í—ã–±–æ—Ä –∫–∞—Ä—Ç—ã"></select>
        <div style="margin-top:8px;">
          <button id="btnLoadMap">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É</button>
          <button id="btnResetMap">–°–±—Ä–æ—Å–∏—Ç—å –∫–∞—Ä—Ç—É</button>
        </div>
      </section>

      <section class="teams">
        <h2>–ö–æ–º–∞–Ω–¥—ã</h2>
        <div class="team" id="teamBlue">
          <h3 style="color:#42a5f5">–°–∏–Ω–∏–µ</h3>
          <div id="bluePlayers"></div>
        </div>
        <div class="team" id="teamRed">
          <h3 style="color:#ef5350">–ö—Ä–∞—Å–Ω—ã–µ</h3>
          <div id="redPlayers"></div>
        </div>
      </section>

      <section class="drawing-tools">
        <h2>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∏—Å–æ–≤–∞–Ω–∏—è</h2>
        <div class="row">
          <label>–¶–≤–µ—Ç: <input type="color" id="drawColor" value="#ff0000" /></label>
        </div>
        <div class="row" style="display: flex; align-items: center; gap: 10px;">
          <label for="drawWeight">–¢–æ–ª—â–∏–Ω–∞:</label>
          <input id="drawWeight" type="range" min="1" max="12" step="1" value="3" />
          <span id="weightVal">3</span>
        </div>
        <div class="row">
          <button id="btnFront">–ù–∞–Ω–µ—Å—Ç–∏ –ª–∏–Ω–∏—é —Ñ—Ä–æ–Ω—Ç–∞</button>
        </div>
        <div class="row">
          <button id="btnFillLower">–ù–∞–Ω–µ—Å—Ç–∏ –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</button>
        </div>
        <div class="row">
          <button id="btnAssault">–ù–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</button>
        </div>
        <div class="row">
          <button id="btnEraser">–û—á–∏—Å—Ç–∏—Ç—å —Ñ—Ä–æ–Ω—Ç</button>
          <button id="btnClearAll">–û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É</button>
        </div>
        <div class="row">
          <button id="btnSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω</button>
        </div>
        <button id="btnSaveImage">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ä—Ç—É –∫–∞–∫ .jpg</button>
        <button id="loadPlan">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω</button>
        <input type="file" id="planFileInput" accept=".json" style="display:none" />
        <div class="note">
          <small>
            –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –ø–∞–Ω–µ–ª–∏ –∫–∞—Ä—Ç—ã. 
            –ù—É–∂–Ω–æ –Ω–∞–∂–∏–º–∞—Ç—å "edit" –∏ –º–µ–Ω—è—Ç—å –ª–∏–Ω–∏—é —Ñ—Ä–æ–Ω—Ç–∞. 
            –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è "save".<br>
            –ê–≤—Ç–æ—Ä ‚Äî saadness
          </small>
        </div>
      </section>
    </aside>

    <main class="map-area">
      <div id="map"></div>
    </main>
  </div>

  <!-- Leaflet + Draw JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- –¢–≤–æ—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã -->
  <script src="script.js"></script>
</body>
</html>
